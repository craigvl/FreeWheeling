@model FreeWheeling.UI.Models.GroupModel
@using FreeWheeling.Domain.Entities 

@{
    ViewBag.Title = "Index";
}

@Html.ValidationSummary()

<div class="row">
    <div class="col-md-12">      
        <p class="text-center">

            @Html.ActionLink("Back Home <---", "Index", "Home", null, new { @class = "btn btn-info" })

            <h3 class="text-left"><span class="label label-primary">Groups</span></h3>
            <h4 class="text-left"><span class="label label-primary">Townsville</span></h4>
                
                @foreach (Group item in Model._Groups)
                {

                    bool isMember = Model.CurrentGroupMembership.Contains(item.id);
                    int RiderCount = Model._NextRideDetails.Where(g => g.GroupId == item.id).Select(g => g.NumberofRiders).FirstOrDefault();
                    DateTime NextRideDate = Model._NextRideDetails.Where(g => g.GroupId == item.id).Select(g => g.Date).FirstOrDefault();
                    
                    if (isMember)
                    {
            
                        @:<h3 class="text-left">
                       
                         @Html.ActionLink(item.name, "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-default" }) 
                         
                         
                         if (item.Rides.Count > 0 )
                         {
                            
                             @Html.ActionLink(string.Concat("View Rides (",RiderCount, " very keen rider/s for ", NextRideDate.DayOfWeek,")")   , "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-success" })
                             
                        @:</h3> 
                             
                         }
                         else
                         {
                             
                              @:<span class="label label-warning">No Rides</span>
                             
                         }
                          
                    }
                    else
                    {
                 
                    <h3 class="text-left">
                  @Html.ActionLink(item.name, "Join", "Group", new { id = item.id }, new { @class = "btn btn-default" }) 
                  @Html.ActionLink("Join!", "Join", "Group", new { id = item.id }, new { @class = "btn btn-success" })</h3>
                    }
                    isMember = false;
                }
</p>
</div>
</div>