@model FreeWheeling.UI.Models.GroupModel
@using FreeWheeling.Domain.Entities 

@{
    ViewBag.Title = "Index";
}

@Html.ValidationSummary()

<div class="row">
    <div class="col-md-12">      
        <p class="text-left">

            @Html.ActionLink("Back Home <---", "Index", "Home", null, new { @class = "btn btn-info" })

            <h3 class="text-left"><span class="label label-primary">@Model.title in @Model.UserLocation</span></h3>
                
                @if (@Model._Groups.Count > 0 )
                {
                                     
                foreach (Group item in Model._Groups)
                {
                   
                    bool isMember = Model.CurrentGroupMembership.Contains(item.id);
                    int RiderCount = Model._NextRideDetails.Where(g => g.GroupId == item.id).Select(g => g.NumberofRiders).FirstOrDefault();
                   
                    DateTime NextRideDate = Model._NextRideDetails.Where(g => g.GroupId == item.id).Select(g => g.Date).FirstOrDefault();
                    
                    if (isMember)
                    {
            
                        @:<h3 class="text-left">
                   
                         if (item.Rides.Count > 0 )
                         {
                             @Html.ActionLink(item.name, "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-default" }) 
                             @Html.ActionLink(string.Concat("View Rides (", RiderCount, " 100% Rider/s for ", NextRideDate.DayOfWeek, ")"), "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-success" })
                             
                        @:</h3> 
                             
                         }
                         else
                         {
                               @Html.Label(item.name)
                              @:<span class="label label-danger">No Rides</span>
                             
                         }
                                               
                         @Html.ActionLink("Remove from favourites", "RemoveFromFavouriteList", "Group", new { id = item.id, title = @Model.title  }, new { @class = "btn btn-danger" })
                          
                    }
                    else
                    {
                 
                    @:<h3 class="text-left">
                            
                         if (item.Rides.Count > 0 )
                         {
                            
                             @Html.ActionLink(item.name, "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-default" }) 
                             @Html.ActionLink(string.Concat("View Rides (",RiderCount, " 100% Rider/s for ", NextRideDate.DayOfWeek,")")   , "Index", "Ride", new { groupid = item.id }, new { @class = "btn btn-success" })
                                   
                         }
                         else
                         {
                             @Html.Label(item.name)
                              @:<span class="label label-danger">No Rides</span>
                             
                         }
                           
                  
                    @Html.ActionLink("Add to favourites", "Join", "Group", new { id = item.id, title = @Model.title }, new { @class = "btn btn-warning" })
                     @:</h3>
                    }
                    isMember = false;
                }
                }
                else
                {
                    
                    @Html.ActionLink("You dont have any favourite groups! Get some!", "Index", "Group", null, new { @class = "btn btn-default" }) 
                    
                }
</p>
</div>
</div>