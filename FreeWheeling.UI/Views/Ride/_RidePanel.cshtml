@* Based on http://jsfiddle.net/WNbLU/ *@
@model FreeWheeling.UI.Models.RideModelIndex
@{
    int position = Convert.ToInt32(ViewData["position"]);
      
    string collapseMainHash = "#collapseFirst";
    string collapseKeenHash = "#collapseKeenFirst";
    string collapseCommentHash = "#collapseCommentFirst";
       
    string collapseMain = "collapseFirst";
    string bunchchevronclass = Model.FirstBunchChevronClass;
    string keenchevronclass = Model.FirstKeenChevronClass;
    string commentchevronclass = Model.FirstCommentChevronClass;
    
    string bunchpannelclass = Model.FirstBunchPanelClass;
    string keenpannelclass = Model.FirstKeenPanelClass;
    string commentpannelclass = Model.FirstCommentPanelClass;
    
    string bunchpanelid = "FirstDetails";
    string keenpanelid = "collapseKeenFirst";
    string commentpanelid = "collapseCommentFirst";

    string commentcollapsearea = "CommentCollapseArea";
    string commentcountid = "CommentCount";
    string keencountid = "KeenCount";

    string riderskeenpartial = "_RidersKeen";
    string keenactionpartial = "_KeenActions";
    string commentpartial = "_Comments";
    
    int rideid = Model.Ride.id;
    int keencount = Model.KeenCount;
    int commentcount = Model.CommentCount;
    DateTime ridedate =  Model.Ride.RideDate;

    if (position == 2)
    {   
        collapseMainHash = "#collapseSecond";
        collapseKeenHash = "#collapseKeenSecond";
        collapseCommentHash = "#collapseCommentSecond";

        collapseMain = "collapseSecond";
        bunchchevronclass = Model.SecondBunchChevronClass;
        keenchevronclass = Model.SecondKeenChevronClass;
        commentchevronclass = Model.SecondCommentChevronClass;
        
        bunchpannelclass = Model.SecondBunchPanelClass;
        keenpannelclass = Model.SecondKeenPanelClass;
        commentpannelclass = Model.SecondCommentPanelClass;

        commentcountid = "CommentCountSecond";
        keencountid = "KeenCountSecond";
        
        bunchpanelid = "SecondDetails";
        keenpanelid = "collapseKeenSecond";
        commentpanelid = "collapseCommentSecond";

        rideid = Model.NextRide.id;
        keencount = Model.NextKeenCount;
        commentcount = Model.NextCommentCount;        
        ridedate =  Model.NextRide.RideDate;
    }
}
<div class="row">
    <div class='panel-group'>
        <div class='panel panel-default'>
            <div class="row">
                <div class="panel-heading">
                    <div class="col-xs-12 col-md-12 col-sm-12">
                        <div>
                            <a class="col-xs-8 col-md-11 col-sm-10" data-toggle=" collapse" href="@collapseMainHash">
                                @ridedate.ToLongDateString() 
                            </a>
                        </div>
                        <div class="col-xs-1 col-md-1 col-sm-1">
                            <a class="@bunchchevronclass" id="@bunchpanelid" data-toggle="collapse" href="@collapseMainHash"></a>
                        </div>
                    </div>
                </div>
            </div>
            <div id="@collapseMain" class="@bunchpannelclass">
                <div class='panel panel-default'>
                    <div class="row">
                        <div class="col-xs-12 col-md-12 col-sm-12" style="">
                            <div class="panel-heading" style="background-color: #FFF; color: #333333;">
                                <div class="col-xs-8 col-md-11 col-sm-10">
                                    <a style="background-color: #FFF; color: #333333;" data-toggle="collapse" href="@collapseKeenHash" class="">Keen</a>
                                    <a style="background-color: #FFF; color: #333333;" id="@("KeenCountSpan"+@rideid)">(@keencount.ToString())</a>
                                </div>
                                <div class="col-xs-1 col-md-1 col-sm-1">
                                    <a style="background-color: #FFF; color: #333333;" class="@keenchevronclass" id="@keencountid" data-toggle="collapse" href="@collapseKeenHash"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="@keenpanelid" class="@keenpannelclass">
                        <div class="panel-body panelBody">
                            <div id="@("keendiv_" + @rideid)">
                                @Html.Partial(@riderskeenpartial, Model, new ViewDataDictionary { { "position", @position } })                             
                            </div>
                            <hr />
                            @Html.Partial(@keenactionpartial, Model, new ViewDataDictionary { { "position", @position } })
                        </div>
                    </div>
                </div>
                <div class='panel panel-default'>
                    <div class="row">
                        <div class="col-xs-12 col-md-12 col-sm-12" style="">
                            <div class="panel-heading" id="@commentcollapsearea" style="background-color: #FFF; color: #333333;">
                                <div class="col-xs-8 col-md-11 col-sm-10">
                                    <a style="background-color: #FFF; color: #333333;" data-toggle="collapse" href="@collapseCommentHash">Comments</a>
                                    <a style="background-color: #FFF; color: #333333;" id="@("CommentCountSpan" + @rideid)">(@commentcount)</a>
                                </div>
                                <div class="col-xs-1 col-md-1 col-sm-1">
                                    <a style="background-color: #FFF; color: #333333;" id="@commentcountid" class="@commentchevronclass" data-toggle="collapse" href="@collapseCommentHash"></a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="@commentpanelid" class="@commentpannelclass">
                        <div id="@commentcollapsearea">
                            <div class="panel-body panelBody">
                                @if (@Model.Comments != null)
                                {
                                    @Html.Partial(@commentpartial, Model, new ViewDataDictionary { { "position", @position } })
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>